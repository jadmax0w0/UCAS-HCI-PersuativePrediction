import numpy as np

import sys; sys.path.append(".")
from feat_extractors.cialdini_extractor import CialdiniFeatureExtractor
from feat_extractors.dim10_extractor import Dim10FeatureExtractor
from feat_extractors.bert_extractor import BertTextFeatureExtractor
from classifiers.bagger.bagger_presets import get_bagger_model
from classifiers.bagger.voting_bagger import VotingBagger
from pipeline import train_model, eval_model, load_model, get_custom_text_features


# O = """我认为人类是没有自由意志的，这一观点可以从经典的神经科学实验中找到有力支撑。早有研究发现，人在实际做出决定与意识到自己做了决定之间，存在一段短则几百毫秒、长则数秒的时间差 —— 当我们主观上觉得 “是自己主动选择做某件事” 时，大脑其实早已提前形成了对应的神经活动模式，完成了决策的核心过程。我们所感知到的 “自主决策” 的体验，本质上更像是大脑为了让我们理解自身行为，事后构建出的一种认知幻觉，而非真正由 “自我意识” 主导的主动选择。这意味着从神经生物学的底层逻辑来看，所谓的自由意志或许并非人类意识的自主产物，而是大脑神经活动的附带结果。
# """

# P = """
# 首先，该结论过度简化了神经实验的场景与结论。支撑 “无自由意志” 的经典实验（如利贝特实验），大多是让受试者做无意义的、瞬间的简单决策（比如随机按左键或右键），这类决策依赖的是大脑的本能反应或随机神经活动，和现实中人类的复杂决策完全不是同一维度。当我们面临 “是否要换一份工作”“要不要帮陌生人一把” 这类需要权衡价值观、道德准则、长期利益的复杂选择时，大脑的活动模式会涉及前额叶皮层的理性分析、记忆调取、情绪整合等多个复杂模块，而非实验中那种单一的 “神经准备电位”。实验中几百毫秒的时延，更可能是大脑对简单动作的预备活动，而非对 “决策本身” 的提前定调，不能用简单场景的结论推导复杂的人类行为。

# 其次，混淆了 “神经活动的提前发生” 与 “决策的不可逆性”。实验中观测到的 “决策前的神经活动”，未必是 “最终决策的定论”，更可能是大脑的 “预选与筹备” 状态 。比如，当你纠结要不要喝奶茶时，大脑可能同时激活 “想喝” 和 “怕胖” 两个神经通路，此时出现的神经活动只是备选方案的预演；而最终你决定 “不喝”，很可能是意识主动介入，压制了 “想喝” 的神经冲动 —— 这个干预过程，恰恰体现了意识对决策的主导性。如果决策真的是大脑提前设定好的 “幻觉”，我们就无法解释 “临时改主意” 这种普遍现象。

# 第三，忽视了意识的 “主动建构与反馈能力”。自由意志的核心并非 “决策比意识早几百毫秒”，而是 “人类能根据自我认知、外部反馈调整后续行为”。比如，一个人第一次偷东西时，可能是本能的欲望驱动，但当他意识到这个行为的道德后果和法律风险后，后续能主动克制自己的欲望 —— 这种 “基于反思的行为修正”，是单纯的神经冲动无法解释的。大脑的神经活动和意识之间，不是 “单向的决定关系”，而是双向的互动关系：意识可以通过学习、反思重塑神经通路，反过来影响未来的决策；这种 “自我塑造” 的能力，正是自由意志的核心体现。

# 最后，对 “自由意志” 的定义陷入了 “非黑即白” 的误区。很多持 “无自由意志” 观点的人，默认自由意志是 “完全脱离物理规律、不受任何因果约束的绝对自由”—— 但这是一种不切实际的定义。从哲学和科学的共识来看，更合理的自由意志定义是 “能够基于自身的意愿、信念和理性，自主做出选择并为选择负责的能力”。即使大脑的决策有神经活动的基础（符合物理因果律），也不影响 “自由意志” 的存在 —— 就像电脑的运行依赖电路和代码，但我们依然会说 “程序员自由地编写了软件”，而非 “代码决定了一切”。人类的决策基于神经活动，但神经活动本身是由我们的经历、思考、价值观塑造的，这种 “自我决定的因果链”，正是自由意志的本质。
# """


# O = """我认为每个人所感受到的世界线，一定会是他们活得最久的那个世界线，这一观点暗含着对 “平行世界” 与 “意识存续” 关系的独特思考。我们不妨假设，每个个体在做出不同选择时，都会衍生出无数条平行的世界线，而在每一条世界线里，都存在着一个对应的 “自己”，这些 “自己” 的人生轨迹、寿命长短各不相同。但从主观意识的视角来看，那些寿命更短的世界线会随着个体生命的终结而失去意识的载体 —— 当某条世界线里的 “自己” 因意外、疾病或其他原因走向生命终点时，这条世界线对应的感知便会随之消散；只有在寿命最长的那条世界线上，意识能够持续存续，直到生命的最后一刻。因此，当所有短寿命世界线的意识都已消亡后，最终剩下的，便是这条最长世界线里的意识，而这个意识所能切实感知到的，自然也就只有自己所在的这条世界线。由此进一步推导，不同人类个体所切实感受到的世界也不一定相同：因为每个个体的人生选择、命运走向存在差异，他们各自对应的 “最长寿命世界线” 也会截然不同 —— 有人会在自己的最长世界线里经历波澜壮阔的冒险，有人则会在另一条最长世界线里过着平淡安稳的生活，这些截然不同的轨迹，便构成了不同个体眼中独一无二的 “真实世界”。"""

# P = """混淆了 “不同世界线意识的独立性” 与 “意识的‘筛选存续’”。观点的核心逻辑是 “短寿命世界线的意识消亡后，会剩下最长寿命世界线的意识”，但这里存在一个关键漏洞：如果平行世界真的存在，那么每条世界线中的 “你” 都是完全独立的意识个体。世界线 A 中活 80 岁的 “你”，和世界线 B 中活 50 岁的 “你”，二者的意识没有任何关联 ——B 世界线的 “你” 在 50 岁因意外离世时，其意识会直接终结，不会 “知道” 还有一条更长的世界线；A 世界线的 “你” 也不会因为 B 世界线意识的消亡，就变成 “唯一剩下的意识”。二者从诞生到存续都是相互隔绝的，不存在 “意识合并” 或 “筛选留存” 的可能，自然也就谈不上 “最终剩下最长世界线的意识”。"""

# P = """这一观点的核心前提缺乏任何科学或实证支撑。其逻辑成立的基础是 “平行世界真实存在” 且 “意识能够在多条平行世界线中独立存续”—— 但这两个前提至今都只是量子力学与科幻作品中的假说，没有任何可重复的实验、观测数据能证明平行世界的存在，更无法验证 “不同世界线中存在同一个体的独立意识”。我们既无法探测到其他世界线的痕迹，也无法证明意识可以脱离单一的物理载体（如大脑）跨世界线存在，整个观点相当于建立在 “空中楼阁” 之上，缺乏最基本的现实根基。"""

# P = """“活得最久” 的判定存在无法解决的逻辑悖论。“最长寿命世界线” 是一个只能 “事后回溯” 的结论，而非可以 “实时感知” 的状态。一个人在当下感知世界的时候，根本无法判定自己是否处于 “最长寿命” 的世界线 —— 比如你现在 30 岁，如何确定未来不会发生意外、疾病，让这条世界线的寿命止步于 50 岁？又如何确定不存在另一条世界线的你能活到 90 岁？只有当生命走到终点的那一刻，你才能知道这条世界线的寿命长度，但此时意识已经走向终结，根本无法再 “感知” 自己是否处于 “最长的那条”。反过来，如果意识真的能筛选最长世界线，那我们在任何时刻都应该 “确定” 自己不会早逝，但现实中每个人都会担忧意外、疾病带来的寿命缩短，这种主观体验本身就和观点矛盾。"""


# O = """网络上时常会出现刻意挑起对立的声音，男女对立便是其中尤为突出的一种。部分女性会将客观存在的社会症结，乃至自身主观感受里难以接受的种种问题，一概归因于男女性别矛盾，还将自己的这类言行标榜为 “女权主义” 的觉醒之举。但事实上，这类人恰恰混淆了问题的核心本质 —— 我们所处的社会，究其根本是一个权力主导的社会，真正值得全体无产阶级共同抗争的对象，从来都是不合理的权力结构与权力垄断，而非陷入无意义的性别内耗。更不该出现的是，一些人将这种性别对立的矛头，指向了同为无产阶级阵营的普通男性，甚至波及到了不具备生产能力、毫无权力关联的小男孩群体。回溯历史不难发现，当下社会残存的男权问题，其根源并非性别本身，而是人类文明步入农耕时代后，生产力发展模式的转变引发了权力在不同性别之间的转移与倾斜；这一矛盾的主要方面，始终是权力的分配与掌控，而非性别差异。若非要论及性别带来的某些区别，那也只能归结于基因层面的倾向差异：男性基因中对高风险高回报的天然追求，使得他们在历史进程中更多地成为权力的追逐者；而女性则因基因里潜藏的风险规避本能 —— 正如雌性哺乳动物需要在安全稳定的环境中完成哺乳抚育后代的任务 —— 在漫长的历史发展中，逐渐在社会角色上表现为权力的依附者，这并非是性别优劣的分野，而是生存与繁衍本能驱动下的角色分化。"""

# P = """观点的核心误区在于，将 “反抗权力” 与 “反抗性别压迫” 对立起来，默认二者是 “二选一” 的关系。但事实上，性别压迫本身就是权力压迫的重要组成部分—— 不合理的权力结构，恰恰是通过 “性别” 这一维度来实现分化与巩固的。比如职场中的同工不同酬、生育歧视，社会层面的女性受教育权受限、家庭暴力维权难，本质上都是权力在性别领域的不平等分配。这些问题并非 “将社会问题归因于性别”，而是性别维度下实实在在的权力压迫。无产阶级的斗争目标是推翻不合理的权力结构，自然也包含了推翻其中的性别压迫；否认性别问题的独立性，反而会让权力结构中最隐蔽的压迫维度被忽视。

# 观点将男性 “追求权力”、女性 “依附权力” 的差异归因于基因本能，这是一种典型的生物决定论误区。从人类学和社会学的视角来看，性别角色的分化远不止基因影响那么简单：在不少原始母系氏族社会中，女性因掌握生育权、农耕主导权而成为权力的核心，这与 “女性基因规避风险、依附权力” 的说法完全相悖；而进入农耕时代后，男性掌握生产力主导权，也并非单纯源于 “高风险高回报” 的基因追求，更多是土地私有制、宗法制度等社会规则不断固化的结果。更关键的是，现代社会中女性在政治、经济、科技等领域的崛起，早已打破了 “基因决定角色” 的刻板印象 —— 当社会制度赋予女性平等的发展机会时，女性同样会主动追求权力、创造价值，这足以证明性别角色的差异，核心是社会建构的产物，而非基因的宿命。"""

# P = """观点认为，女性将矛头指向普通男性、小男孩是 “内斗”，但实际上，真正的性别抗争，从来不是针对 “男性个体”，而是针对附着在男性群体上的 “结构性性别特权”。比如，批判 “职场中男性更容易获得晋升机会”，不是批判某个男性同事，而是批判背后的权力规则；反对 “重男轻女” 的观念，不是针对小男孩，而是针对将性别与 “价值” 绑定的腐朽思想。将 “反抗性别特权” 等同于 “攻击男性个体”，是对性别抗争的刻意曲解。相反，忽视普通男性身上可能存在的性别特权（比如无意识的性别歧视），反而会让权力结构的压迫持续隐形 —— 真正的无产阶级团结，不是回避性别问题，而是让所有被压迫者（包括受性别特权间接伤害的普通男性）意识到，推翻包含性别压迫的权力结构，才是共同的出路。

# 观点将男权问题的根源归结为农耕时代的生产力变化，这种解释过于单一。事实上，男权制度的形成是生产力、生产关系、文化意识形态共同作用的结果：生产力提升带来的剩余价值积累，催生了私有制，而私有制的传承又强化了 “父系血缘” 的重要性；同时，宗教、礼教等意识形态不断宣扬 “男尊女卑” 的观念，让性别不平等从 “权力分配” 变成了 “社会共识”。这些因素相互交织，才最终固化了男权结构。若只将其归因于 “生产力驱动的权力转移”，就会忽视权力结构主动维系自身存在的能动性 —— 即使进入工业时代、信息时代，生产力模式早已改变，性别压迫依然存在，这恰恰说明，男权问题的本质不只是生产力的产物，更是权力结构刻意维系的结果。"""


if __name__ == "__main__":
    model = get_bagger_model(enable_xgb=False)

    bert_ext = BertTextFeatureExtractor("/Users/youxseem/Documents/AIModels.localized/bert-base-multilingual-cased", minibatch_size=128)
    cial_ext = CialdiniFeatureExtractor()  # TODO: cialdini extractor WIP
    dm10_ext = Dim10FeatureExtractor()

    model = load_model("model/test2.pkl")
    assert isinstance(model, VotingBagger)
    bert_ext.train()
    cial_ext.train()

    # o = input("Opinion:\n")
    # p = input("Persuasive:\n")
    # cial = input("Cialdini (split with comma)\n[Reciprocity, Consistency, Social_Proof, Authority, Scarcity, Liking]:\n")
    # cial = np.array([int(v) for v in cial.split(",")]).reshape(1, -1)
    cial = np.array([[0,0,0,0,0,0]])
    o = O
    p = P
    o_feat = get_custom_text_features(
        text=o,
        bert_extractor=bert_ext,
    )
    p_feat = get_custom_text_features(
        text=p,
        cialdini_extractor=cial,
        # dim10_extractor=dm10_ext,
        bert_extractor=bert_ext,
    )
    feat = np.concat([p_feat, o_feat], axis=-1)
    print(f"{feat.shape=}")

    y_pred = model.predict(feat)
    print(f"{y_pred=}")